{{define "content"}}
<div class="card">
    <h2>Remove This Node from Cluster</h2>

    {{if not .ClusterEnabled}}
    <div class="alert alert-warning">
        <strong>Cluster Not Enabled</strong>
        <p>This server is running in single instance mode. There is no cluster to leave.</p>
    </div>
    {{else}}
    <div class="alert alert-error">
        <strong>Warning: This action is irreversible!</strong>
        <p>Removing this node from the cluster will:</p>
        <ul class="list-styled-spaced">
            <li>Notify other cluster nodes of this node's departure</li>
            <li>Release any distributed locks held by this node</li>
            <li>Clear cluster-related configuration</li>
            <li>Restart this instance in single-node mode</li>
        </ul>
    </div>

    <table class="info-table">
        <tr><td>This Node ID</td><td><code>{{.NodeID}}</code></td></tr>
        <tr><td>Role</td><td>{{if .IsPrimary}}<span class="badge badge-success">Primary</span>{{else}}<span class="badge">Secondary</span>{{end}}</td></tr>
        <tr><td>Active Nodes</td><td>{{.ActiveNodes}} of {{.TotalNodes}}</td></tr>
    </table>

    {{if .IsPrimary}}
    <div class="alert alert-warning mt-md">
        <strong>Primary Node Warning</strong>
        <p>This node is currently the primary. Removing it will trigger a leadership election among remaining nodes.</p>
    </div>
    {{end}}

    <form id="remove-form" onsubmit="removeNode(event)">
        <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">

        <div class="form-group mt-md">
            <label for="confirm-text">Type "REMOVE" to confirm</label>
            <input type="text" id="confirm-text" name="confirm" placeholder="REMOVE" required>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-error">Remove This Node</button>
            <a href="/admin/server/nodes" class="btn">Cancel</a>
        </div>
    </form>
    {{end}}
</div>

<div class="card">
    <h2>Alternative: Graceful Shutdown</h2>
    <p class="text-muted">
        If you want to temporarily take this node offline for maintenance, consider using
        maintenance mode instead. This will prevent new requests while allowing existing
        operations to complete gracefully.
    </p>
    <div class="form-actions">
        <a href="/admin/system/maintenance" class="btn btn-secondary">Go to Maintenance</a>
    </div>
</div>
{{end}}

{{define "scripts"}}
<script>
function removeNode(e) {
    e.preventDefault();

    const confirmText = document.getElementById('confirm-text').value;
    if (confirmText !== 'REMOVE') {
        showError('Please type "REMOVE" to confirm');
        return;
    }

    showConfirm('Are you absolutely sure you want to remove this node from the cluster?', async function() {
        try {
            const resp = await fetch('/api/v1/admin/server/nodes/leave', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const data = await resp.json();
            if (data.success) {
                showSuccess('Node removed from cluster. Restarting in single-node mode...');
                setTimeout(() => {
                    window.location.href = '/admin/server/nodes';
                }, 3000);
            } else {
                showError('Error: ' + data.error);
            }
        } catch (e) {
            showError('Error: ' + e.message);
        }
    });
}
</script>
{{end}}

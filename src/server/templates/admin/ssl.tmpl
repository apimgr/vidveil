{{define "content"}}
<div class="card">
    <h2>SSL/TLS Status</h2>
    <table class="info-table">
        <tr><td>Mode</td><td>{{.SSLMode}}</td></tr>
        <tr><td>Certificate</td><td>{{if .SSLEnabled}}<span class="badge badge-success">Active</span>{{else}}<span class="badge badge-warning">Not Configured</span>{{end}}</td></tr>
        {{if .SSLEnabled}}
        <tr><td>Domain</td><td>{{.SSLDomain}}</td></tr>
        <tr><td>Expires</td><td>{{.SSLExpiry}}</td></tr>
        <tr><td>Issuer</td><td>{{.SSLIssuer}}</td></tr>
        {{end}}
    </table>
</div>

<div class="card">
    <h2>Let's Encrypt</h2>
    <form id="ssl-form" onsubmit="saveSSLSettings(event)">
        <div class="form-group">
            <label class="toggle-label">
                <input type="checkbox" id="ssl-enabled"{{if .Config.Server.SSL.Enabled}} checked{{end}}>
                <span>Enable Let's Encrypt</span>
            </label>
        </div>
        <div class="form-group">
            <label for="ssl-domain">Domain</label>
            <input type="text" id="ssl-domain" value="{{.Config.Server.SSL.Domain}}" placeholder="example.com">
            <p class="help-text">Domain must be publicly resolvable</p>
        </div>
        <div class="form-group">
            <label for="ssl-email">Email</label>
            <input type="email" id="ssl-email" value="{{.Config.Server.SSL.Email}}" placeholder="admin@example.com">
            <p class="help-text">Required for certificate notifications</p>
        </div>
        <div class="form-group">
            <label for="ssl-challenge">Challenge Type</label>
            <select id="ssl-challenge">
                <option value="http-01"{{if eq .Config.Server.SSL.Challenge "http-01"}} selected{{end}}>HTTP-01</option>
                <option value="tls-alpn-01"{{if eq .Config.Server.SSL.Challenge "tls-alpn-01"}} selected{{end}}>TLS-ALPN-01</option>
                <option value="dns-01"{{if eq .Config.Server.SSL.Challenge "dns-01"}} selected{{end}}>DNS-01</option>
            </select>
        </div>
        <div class="button-group">
            <button type="submit" class="btn btn-primary">Save Changes</button>
            {{if .SSLEnabled}}
            <button type="button" onclick="renewCert()" class="btn btn-secondary">Force Renewal</button>
            {{end}}
        </div>
    </form>
</div>

<div class="card">
    <h2>Custom Certificate</h2>
    <p class="text-muted">Upload your own SSL certificate instead of using Let's Encrypt.</p>
    <form id="cert-upload-form" onsubmit="uploadCert(event)">
        <div class="form-group">
            <label for="cert-file">Certificate File (.crt, .pem)</label>
            <input type="file" id="cert-file" accept=".crt,.pem">
        </div>
        <div class="form-group">
            <label for="key-file">Private Key File (.key, .pem)</label>
            <input type="file" id="key-file" accept=".key,.pem">
        </div>
        <div class="button-group">
            <button type="submit" class="btn btn-secondary">Upload Certificate</button>
        </div>
    </form>
</div>
{{end}}

{{define "scripts"}}
<script>
async function saveSSLSettings(e) {
    e.preventDefault();
    try {
        const resp = await fetch('/api/v1/admin/config', {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                server: {
                    ssl: {
                        enabled: document.getElementById('ssl-enabled').checked,
                        domain: document.getElementById('ssl-domain').value,
                        email: document.getElementById('ssl-email').value,
                        challenge: document.getElementById('ssl-challenge').value
                    }
                }
            })
        });
        const data = await resp.json();
        if (data.success) { showSuccess('SSL settings saved!'); }
        else { showError('Error: ' + data.error); }
    } catch (e) { showError('Error: ' + e.message); }
}

async function renewCert() {
    try {
        const resp = await fetch('/api/v1/admin/server/ssl/renew', { method: 'POST' });
        const data = await resp.json();
        if (data.success) { showSuccess('Certificate renewal started!'); }
        else { showError('Error: ' + data.error); }
    } catch (e) { showError('Error: ' + e.message); }
}

function uploadCert(e) {
    e.preventDefault();
    showWarning('Certificate upload not implemented yet');
}
</script>
{{end}}

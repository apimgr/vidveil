{{define "content"}}
<div class="card">
    <h2>Site Branding</h2>
    <form id="branding-form" onsubmit="saveBranding(event)">
        <div class="form-group">
            <label for="site-title">Site Title</label>
            <input type="text" id="site-title" value="{{.Config.Server.Title}}" placeholder="Vidveil" aria-describedby="site-title-help">
            <p class="help-text" id="site-title-help">Displayed in browser tab and header</p>
        </div>
        <div class="form-group">
            <label for="site-tagline">Tagline</label>
            <input type="text" id="site-tagline" value="{{.Config.Web.Branding.Tagline}}" placeholder="Privacy-First Video Search" aria-describedby="site-tagline-help">
            <p class="help-text" id="site-tagline-help">Short description shown below title</p>
        </div>
        <div class="form-group">
            <label for="site-description">Description</label>
            <textarea id="site-description" rows="3" placeholder="Meta description for SEO" aria-describedby="site-description-help">{{.Config.Server.Description}}</textarea>
            <p class="help-text" id="site-description-help">Used for SEO meta tags</p>
        </div>
        <div class="button-group">
            <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
    </form>
</div>

<div class="card">
    <h2>SEO Settings</h2>
    <form id="seo-form" onsubmit="saveSEO(event)">
        <div class="form-group">
            <label for="seo-keywords">Keywords</label>
            <input type="text" id="seo-keywords" value="" placeholder="video, search, privacy">
            <p class="help-text">Comma-separated keywords for meta tags</p>
        </div>
        <div class="form-group">
            <label class="toggle-label">
                <input type="checkbox" id="seo-indexing" checked>
                <span>Allow Search Engine Indexing</span>
            </label>
            <p class="help-text">Controls robots.txt behavior</p>
        </div>
        <div class="button-group">
            <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
    </form>
</div>

<div class="card">
    <h2>Logo & Favicon</h2>
    <form id="logo-form" onsubmit="uploadLogo(event)">
        <div class="form-group">
            <label>Current Logo</label>
            <div class="logo-preview">
                <img src="/static/images/logo.svg" alt="Current logo" class="logo-preview">
            </div>
        </div>
        <div class="form-group">
            <label for="logo-file">Upload New Logo</label>
            <input type="file" id="logo-file" accept=".svg,.png,.jpg,.jpeg" aria-describedby="logo-help">
            <p class="help-text" id="logo-help">SVG recommended, max 512KB</p>
        </div>
        <div class="form-group">
            <label for="favicon-file">Upload Favicon</label>
            <input type="file" id="favicon-file" accept=".ico,.png" aria-describedby="favicon-help">
            <p class="help-text" id="favicon-help">ICO or PNG, 32x32 or 64x64</p>
        </div>
        <div class="button-group">
            <button type="submit" class="btn btn-secondary">Upload</button>
        </div>
    </form>
</div>
{{end}}

{{define "scripts"}}
<script>
async function saveBranding(e) {
    e.preventDefault();
    try {
        const resp = await fetch(window.API_BASE + '/server/branding', {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                title: document.getElementById('site-title').value,
                tagline: document.getElementById('site-tagline').value,
                description: document.getElementById('site-description').value
            })
        });
        const data = await resp.json();
        if (data.success) { showSuccess('Branding saved!'); }
        else { showError('Error: ' + data.error); }
    } catch (e) { showError('Error: ' + e.message); }
}

async function saveSEO(e) {
    e.preventDefault();
    try {
        const resp = await fetch(window.API_BASE + '/server/branding', {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                keywords: document.getElementById('seo-keywords').value.split(',').map(k => k.trim()),
                allow_indexing: document.getElementById('seo-indexing').checked
            })
        });
        const data = await resp.json();
        if (data.success) { showSuccess('SEO settings saved!'); }
        else { showError('Error: ' + data.error); }
    } catch (e) { showError('Error: ' + e.message); }
}

// Logo/Favicon upload per AI.md PART 17
async function uploadLogo(e) {
    e.preventDefault();

    const logoFile = document.getElementById('logo-file').files[0];
    const faviconFile = document.getElementById('favicon-file').files[0];

    if (!logoFile && !faviconFile) {
        showWarning('Please select a file to upload');
        return;
    }

    // Upload logo if selected
    if (logoFile) {
        const logoForm = new FormData();
        logoForm.append('type', 'logo');
        logoForm.append('file', logoFile);

        try {
            const resp = await fetch(window.API_BASE + '/server/branding/upload', {
                method: 'POST',
                body: logoForm
            });
            const data = await resp.json();
            if (data.success) {
                showSuccess('Logo uploaded successfully');
            } else {
                showError(data.error || 'Failed to upload logo');
                return;
            }
        } catch (err) {
            showError('Error: ' + err.message);
            return;
        }
    }

    // Upload favicon if selected
    if (faviconFile) {
        const faviconForm = new FormData();
        faviconForm.append('type', 'favicon');
        faviconForm.append('file', faviconFile);

        try {
            const resp = await fetch(window.API_BASE + '/server/branding/upload', {
                method: 'POST',
                body: faviconForm
            });
            const data = await resp.json();
            if (data.success) {
                showSuccess('Favicon uploaded successfully');
            } else {
                showError(data.error || 'Failed to upload favicon');
                return;
            }
        } catch (err) {
            showError('Error: ' + err.message);
            return;
        }
    }

    // Reload page to show new images
    if (logoFile || faviconFile) {
        location.reload();
    }
}
</script>
{{end}}
